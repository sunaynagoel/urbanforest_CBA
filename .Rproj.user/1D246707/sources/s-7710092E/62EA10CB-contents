---
title: "Cost-Benefit Analysis of Urban Forest"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    social: menu
    source: embed
    runtime: shiny
---

```{r, message=FALSE, warning=FALSE }
#message=FALSE, warning=FALSE, include=FALSE, echo=FALSE
# install packages and library

# install.packages("leaflet")
#install.packages("flexdashboard")
#install.packages("shiny")
#install.packages("here")
#install.packages("dplyr")
#install.packages ("kableExtra")
#install.packages ("FinancialMath")

library(shiny)
library(flexdashboard)
library(leaflet)
library(here)
library(dplyr)
library(kableExtra)
library(FinancialMath)
```


```{r global, include=FALSE}

# message=FALSE, warning=FALSE, include=FALSE, echo=FALSE
# load data 
dat <- read.csv(here("data/trees-cost-benefit.csv"))
dat.cost.correct <- read.csv(here("data/costdetails_correct.csv"))
dat.cost.convenient <- read.csv(here("data/costdetails_convenient.csv"))

```

<style type="text/css"> .sidebar { overflow: auto; } </style>

Introduction {data-orientation=columns}
=========================================
 
Column {.sidebar data-width=300}
-----------------------------------------------------------------------
 
 
### Cost Benefit Analysis of developing Urban Forest in Phoenix, AZ. 

**Location**: Phoenix, AZ -- State Capital of Arizoan and Fifth most populous ciy in the United States.    
**Objectives**: Increase the Urban forest to offset the Carbon-Di-Oxide (CO2) generated by air travel by providing Cost-Beneefit analysis of five most comman urban tree species in the area.    
**Data Used**: Cost and Benefit of each of those species for a span 30 years.    
**Process**: Investigate the number of trees needed to offest the CO2 generated by a flight. Then navigate through details of cost and benefit provided by these trees while presenting the user with Net Present Value of the tree investement. 


Column 
----------------------------------


### Phoenix 

```{r}
fillRow( 
        
leaflet() %>%
  addTiles(options = providerTileOptions(minZoom = 8, maxZoom = 10)) %>%
  addMarkers(lng=-112.0740, lat=33.4484, popup="City Center Phoenix, AZ")

)
```

Analysis {data-orientation=columns}
=========================================

Column {.sidebar data-width=500}
-----------------------------------------------------------------------

### Carbon generated by flights and Trees needed to offset that carbon

**Six hours flight** (cross country flight) generates approximately **3700 lbs of carbon** in a round trip.     
**Three hours flight** (Same sector flight) generates approximately **1270 lbs of carbon** in a round trip.      
**Two hour flight** (same sector shorter flight) generates approximately **950 lbs of carbon** in a round trip.    
**One hour flight** generates approximately **380 lbs of carbon** in a round trip.    
The carbon is calculated for a **single passenger in economy class**.   

```{r}

selectInput("lbs_carbon", label = "Carbon generated by a round trip airtravel:",
            choices = c(3700, 1270, 950,380), selected = 3700)

sliderInput("num_trips", label = "Number of round Trips:",
            min = 1, max = 100, value = 1, step = 2, round = TRUE )

selectInput("species_trees", label = "select type of tree to be planted:",
            choices = c("mesquite", "blue palo verde", "aleppo pine", "palo brea", "chinese elm"), selected = "mesquite")

```

Column 
----------------------------------

### Amount of carbon reduced per tree in thirty year period and number of trees needed to offset it


```{r}
#colnames(dat)

# use the user input of trees to filter data
renderTable ({
input.dat <- dat %>% 
  filter (species %in% input$species_trees)

# filter type convenient 
convenient.dat <-input.dat %>% 
  filter (correct_vs_convenient == "convenient") 

# calculate the carbon reduced by one tree by convenient installation 
carbon_convenient <- sum(convenient.dat$co2reduction_lb) 
#carbon_convenient
# number of trees needed to offset carbon 
n_tree_convenient <- round (( as.numeric(input$lbs_carbon)/carbon_convenient) * input$ num_trips)

if (n_tree_convenient <= 0)
{
  n_tree_convenient <- 1
}

tree_convenient_cost <- round(as.numeric (n_tree_convenient*510))
#n_tree_convenient
# filter type correct 



correct.dat <- input.dat %>% 
filter (correct_vs_convenient == "correct") 

# calculate the carbon reduced by one tree by convenient installation 
carbon_correct <- sum(correct.dat$co2reduction_lb) 

#carbon_correct
# can't get input$lbs_carbon to work 
n_tree_correct <- round ((as.numeric(input$lbs_carbon)/carbon_correct) * input$ num_trips)

if (n_tree_correct <= 0)
{
  n_tree_correct <- 1
}

tree_correct_cost <- round (as.numeric(n_tree_correct*14000))
#n_tree_correct
table.output <- matrix(c(carbon_convenient, n_tree_convenient, tree_convenient_cost, carbon_correct, n_tree_correct,   tree_correct_cost ), ncol=3, byrow=TRUE)
colnames(table.output) <- c("Carbon_reduced_lbs","Number_of_trees_needed", "Total_offset_cost")
rownames(table.output) <- c("Convenient Planting","Correct Planting")
table.output <- data.frame(table.output)
table.output
}, striped = TRUE, hover = TRUE, bordered = TRUE,
   width = "auto", 
  rownames = TRUE, colnames = TRUE
)


# give some details about the tree or link to a webpage connecting to that tree details
```


*** 
Some detail about the tree or an external link to another website with tree characteristic 


Cost and Benefit {.storyboard}
=========================================

### Urban Tree Installtion 

Urban trees face special challenges with soil quality and root space. Two methods of installing urban trees are covered under this study - **Correct Method** and **Convenient Method**.     

The *correct method* of installing tree may be expensive but it *increases the lifespan* of trees and the *overall benefit* derived from them. Since the trees installed using this method have higher life span, the cost associated with replacing trees is very minimal as well.     
These are the **ten steps** of *planting a mature tree correctly* in urban area (McDonagh,2015):     
1.	Calculate and create a soil volume under paving (sidewalks, plazas, parking lots, etc.) of at least 1,000 cubic feet per tree.  
2.	Create, at minimum, a 5′ x 5′ tree pit openings to allow for adequate trunk flare.   
3.	Slope concrete sidewalk to direct stormwater into tree pit openings.   
4.	Select 5cm (2”) caliper balled-and-burlapped trees with strong central leaders and side-branches uniformly spaced above 1.8m (6’), all branches no more than half the diameter of the main tree-trunk at that branch/trunk junction.    
5.	Place the root package in the ground, removing ropes, strings, burlap and wire basket two-thirds the way down the root ball.   
6.	Find original nursery soil line in the root ball with a surveyor’s pin or landscape spike. This is excess soil, remove it. This original soil line is now the finished top elevation of the root ball.     
7.	Locate, cut and remove any girdling (adventitious) roots on the trunk above the original nursery soil line.    
8.	Backfill loam around the outside perimeter of the root ball and eliminate any air pockets, do not place additional soil above the old nursery soil line on top of the root ball.    
9.	Place wood chip mulch on root ball similar to a saucer: no chips against the trunk; 2” (5 cm) deep on top of the root ball and 10cm (4”) deep at the perimeter.    
10.	Water in root ball thoroughly at planting, and several more times during that growing season.  

Following these ten steps, the *proper installation cost* of a matured tree comes to **$16,341/tree**.

Trees can be planted following **convenient method**, where preparation work is minimal. According to this method (64 ft3 of loam per tree) the installation cost is kept down, but research shows that trees planted with method *need replacing three times throughout their lives*. The insatllation cost included *transport, site preparation and clean up, equipment, and miscellaneous supplies*. The estimates are based on [howmuch.net](https://howmuch.net/costs/tree-install).   
Following the *convenient method* the installation cost comes to :    

For *large tree (14ft- 20ft)* is **$2420/tree**  
For *medium tree (8ft-10ft)* is **$255/tree**  
For *small tree (4ft-6ft)* is **$105/tree**


### Cost of planting and maintaining trees {data-commentary-width=600}

```{r}
# Correct Installtion 
# make a table showing cost in half of story board


  kable(dat.cost.correct) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = F, position = "left")
 
# convenient Installtion 
# make a table SHowing cost in half of story board 

  kable(dat.cost.convenient) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = F, position = "left")

```

*** 
Cost of maintaining urban trees can viewed under these major categories:    

•	**Irrigation Cost** – Due to arid climate of the southwest region newly planted trees need irrigation for three to five years. The survival rate can decrease dramatically without irrigation lines. Once planted, trees typically require about 1,000 gal (3.8 m3) per year during the establishment period and 4,000 gal (15.1 m3) per year as they mature (McPherson, et al., 2004). With a water price of approximately $3.40/1000 gallons in Phoenix average annual irrigation water costs are around than $8.0/tree/year (Kuhney, 2014).   

•	**Pruning and maintenance**- In the Desert Southwest region Pruning expenditure is single greatest cost in public trees. Pruning costs are higher at $12-$14/tree/year in Phoenix because of the long growing seasons and frequent irrigation (McPherson, et al., 2004, pg. 20).     

•	**Tree Removal and disposal**- More often than not trees need to be removed and disposed for various reasons. Trees are removed because sometimes they don’t survive, to resolve conflicts or because of weather related damages.For phoenix region average mortality rate is 2.5% for the first five years and 0.8% thereafter. Based on the mortality rate the cost of removing trees can be estimated at $2.50/tree/year (McPherson, et al., 2004, pg. 19). In case of correct installation chances of tree removal is negligible and set to zero.     

•	**Administration and cleaning costs**- Administration and inspection costs were the next largest expenditure, ranging from approximately 8–35% of annual expenditures which is about $2–$5/tree/year ("Using Trees and Vegetation to Reduce Heat Islands", 2019). This also includes cost of sweeping streets. Street trees drop leaves, flowers, fruit, and branches year-round that constitute a significant portion of debris collected from city streets. Costs include additional labor needed to maintain irrigation line, remove leaves, and property damage caused by localized flooding.    

•	**Pest control and Fertilization cost** - The tree species found commonly in South-West Desert area have very low susceptibility to common pests found nationwide. The i-Tree Eco model provides valuable data about what pests may become a concern. The pests most likely to influence the urban forest in the project area are Gypsy Moth and Asian Long horned Beetle ("Community Forest Assessment", 2014). The Desert Southwest region are spending approximately $ 0.01/ tree/ year on pest control and fertilization (McPherson, et al., 2004, pg. 21).    

•	**Liability and Legal cost**- The Desert Southwest region Spends relatively less to manage conflicts between trees and power lines, sidewalks, sewers, and other elements of the urban infrastructure. Many street trees are planted in wide areas along boulevards where they do not conflict with sidewalks or power lines. Also, tree populations in Desert Southwest cities contain small-stature trees than in other regions of the country. The region typically spends about $ 0.01/ tree/ year because fewer conflicts and type of trees (McPherson, et al., 2004, pg. 21).  


### Details of benefits derived from urban trees

**Benefits from the trees:** 
Trees are a valuable asset. Benefit of tree planting or increasing urban canopy cover can be broadly given classified into six categories.    
•	**Reduction in stormwater runoff** - Trees act as mini-reservoirs, controlling runoff at the source. Trees reduce runoff by intercepting and holding rain on leaves, branches and bark, increasing infiltration and storage of rainwater through the tree's root system and reducing soil erosion by slowing rainfall before it strikes the soil.    

•	**Increase in property value** - Trees are known to increase property. Real estate agents have long known that trees can increase the "curb appeal" of properties thereby increasing sale prices. The value depends on type of trees, some add more, and some add less to the property value.    

•	**Reduction in annual cooling cost for household**- Strategically placed trees can increase home energy efficiency. In summer, trees shading east, and west walls keep buildings cooler. In winter, allowing the sun to strike the southern side of a building can warm interior spaces. Trees modify climate and conserve building energy use by (a) shading reduces the amount of heat absorbed and stored by buildings. (b) evaporation cools down the atmospheric temperature. (c)Tree canopies slow down winds thereby reducing the amount of heat or cooling lost from a home, especially where conductivity is high (e.g., glass windows).     

•	**Air quality and Natural Gas improvement**- Air pollution in urban areas poses serious health threat that causes asthma, coughing, headaches, respiratory and heart disease, and cancer. Urban forest can reduce the health effects of pollution by absorbing pollutants like CO2, NO2 and Sulphur dioxide, releasing oxygen, reducing production of ozone, intercepting particulate matter (dust, smoke, and ash), and finally by reducing energy usage thereby reducing emission from power plants. However, trees themselves emit biogenic volatile organic compounds (BVOCs) which can contribute to ground-level ozone production. This can be calculated based on type of tree and reduced from overall benefit to arrive at net benefit.     

•	**Reduction in atmospheric CO2**- Trees reduce atmospheric carbon by sequestering (locking up) CO2 in their roots, trunks, stems and leaves while they grow, and in wood products after they are harvested. They also reduce atmospheric CO2 by reducing heating and cooling demand which in turn reduces emission associated with power generation. This number is very significant to understand individual “footprint”. For e.g.; A flight from New York to Los Angeles adds 1,400 pounds of CO2 per passenger.     

There are **aesthetic and other benefits** associated with planting trees as well.  Such as; 
•	Social and Psychological benefits    
•	Human health benefits   
•	Noise reduction    
•	Increase in Urban Wildlife   
•	Environment related jobs and education

For the purpose of this paper benefits related to the air-quality and hydrology are considered. 

### Benefits from the tree planted correctly 
```{r, fig.align='center', fig.height= 2, fig.width=3}
# make a graph showing benefit of correct planting the chosen tree /year for 30 years (1 tree)

renderPlot ({
  input.dat <- dat %>% 
  filter (species %in% input$species_trees)

# filter type correct 
correct.dat <-input.dat %>% 
  filter (correct_vs_convenient == "correct") 
  
 StormWater_Runoff <-  round(sum (correct.dat$ben_storm_water))
 PropertyValue <-  round(sum(correct.dat$ben_property_value))
 Electricity <- round(sum(correct.dat$ben_electricity))
 AirQuality <- round(sum(correct.dat$ben_air_quality))
 NaturalGas <- round(sum(correct.dat$ben_naturalgas))
 CarbonReduction <- round(sum(correct.dat$ben_co2_reduction))
 
 table.benefit.correct <- c(StormWater_Runoff, PropertyValue, Electricity, AirQuality, NaturalGas, CarbonReduction)
 
 bp.correct <- barplot(table.benefit.correct, 
         main = "Benefits from planting tree correctly",
         xlab = "Types of Benefits",
         ylab = "Amount ($)",
         ylim = c(0,600),
         names.arg = c("StormWater_Runoff", "PropertyValue", "Electricity", "AirQuality", "NaturalGas", "CarbonReduction"),
         col = "steelblue") 
  text(bp.correct, 100, round(table.benefit.correct, 1),cex=1,pos=3) 
 
})
  
```

*** 
These benefits are derived from planting one selected species correctly for a 30 years period. 

### Benefits from the tree planted conveniently 

```{r}


# make a graph showing benefit of convenient planting the chosen tree /year for 30 years (1 tree)
renderPlot ({
  
  input.dat <- dat %>% 
  filter (species %in% input$species_trees)
# filter type convenient 
convenient.dat <- input.dat %>% 
  filter (correct_vs_convenient == "convenient") 

 StormWater_Runoff <-  round(sum (convenient.dat$ben_storm_water))
 PropertyValue <-  round(sum(convenient.dat$ben_property_value))
 Electricity <- round(sum(convenient.dat$ben_electricity))
 AirQuality <- round(sum(convenient.dat$ben_air_quality))
 NaturalGas <- round(sum(convenient.dat$ben_naturalgas))
 CarbonReduction <- round(sum(convenient.dat$ben_co2_reduction))
 
 table.benefit.convenient <- c(StormWater_Runoff, PropertyValue, Electricity, AirQuality, NaturalGas, CarbonReduction)
 
 bp.convenient <- barplot(table.benefit.convenient, 
         main = "Benefits from planting tree conveniently",
         xlab = "Types of Benefits ",
         ylab = "Amount ($)",
         ylim = c(0,600), 
         names.arg = c("StormWater_Runoff", "PropertyValue", "Electricity", "AirQuality", "NaturalGas", "CarbonReduction"),
         col = "steelblue") 
 text(bp.convenient, 100, round(table.benefit.convenient, 1),cex=1,pos=3) 
 
})
```

*** 
These benefits are derived from planting one selected species conveniently for a thirty years period.    

Please note that the benefit are reset at year 15 or 16 under this method because usually trees need to be replanted. 



### Net present Value of Cost Benefit analysis 

```{r}
# NPV from the tree installtion and explaination in case of correct and convenient installtion
#NPV(cf0,cf,times,i,plot=FALSE)

renderTable({
  
 input.dat <- dat %>% 
  filter (species %in% input$species_trees)

# filter type correct 
correct.dat <-input.dat %>% 
  filter (correct_vs_convenient == "correct") 
   
cost.correct.y0 <-  correct.dat %>% 
  filter (year == 0) %>% 
  select (cost_total)


cashflow.correct.yearly <- correct.dat %>% 
  filter (year == 1 |  year == 2 | year == 3 | year == 4 | year == 5 | year == 6 |year == 7 | year == 8 | year == 9 | 
             year == 10 | year == 11| year == 12| year == 13 | year == 14 | year == 15 | year == 16 | year == 17 | year == 18 |
             year == 19| year == 20| year == 21| year == 22| year == 23 | year == 24 | year == 25 | year == 26 | year == 27 |
             year == 28 | year == 29 | year == 30 ) %>% 
          select(ben_total)

cashflow.correct.yearly <- as.numeric(unlist(cashflow.correct.yearly[[1]])) 

times.correct <- as.numeric(1:30)

interest.npv <- as.numeric(.03)

npv.correct <- NPV (as.numeric(cost.correct.y0), cashflow.correct.yearly, times.correct, interest.npv, plot=FALSE )

npv.table.correct <- data.frame ( "Details" = c("Net Present Value of benefits over 30 years period from Planting tree CORRECTLY"),
                            "Value" = npv.correct)
npv.table.correct


# filter type convenient 
convenient.dat <-input.dat %>% 
  filter (correct_vs_convenient == "convenient") 

  cost.convenient.y0 <-  convenient.dat %>% 
  filter (year == 0) %>% 
  select (cost_total)


cashflow.convenient.yearly <- convenient.dat %>% 
  filter (year == 1 |  year == 2 | year == 3 | year == 4 | year == 5 | year == 6 |year == 7 | year == 8 | year == 9 | 
             year == 10 | year == 11| year == 12| year == 13 | year == 14 | year == 15 | year == 16 | year == 17 | year == 18 |
             year == 19| year == 20| year == 21| year == 22| year == 23 | year == 24 | year == 25 | year == 26 | year == 27 |
             year == 28 | year == 29 | year == 30 ) %>% 
          select(ben_total)

cashflow.convenient.yearly <- as.numeric(unlist(cashflow.convenient.yearly[[1]])) 

times.convenient <- as.numeric(1:30)

interest.npv <- as.numeric(.03)

npv.convenient <- NPV (as.numeric(cost.convenient.y0), cashflow.convenient.yearly, times.convenient, interest.npv, plot=FALSE )


npv.table.convenient <- data.frame ( "Details" = c("Net Present Value of benefits over 30 years period from Planting tree           CONVENIENTLY"),
                            "Value" = npv.convenient)

#kable (npv.table.convenient) %>% 
#  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = F, position = "left")

npv.table.output <- matrix(c(npv.convenient, npv.correct ), ncol=1,byrow=TRUE)
colnames(npv.table.output) <- c("NPV of benefits for 30 years period")
rownames(npv.table.output) <- c("Convenient Planting","Correct Planting")
npv.table.output <- data.frame(npv.table.output)
npv.table.output
}, striped = TRUE, hover = TRUE, bordered = TRUE,
   width = "auto", 
  rownames = TRUE, colnames = TRUE
)
  
```

***
How is NPV Calculated 


About {.storyboard}
=========================================

### About the Developer 


### Documentation 
